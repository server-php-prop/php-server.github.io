<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

    <textarea id="T"></textarea>

<script>
// --- НАСТРОЙКИ ---
const API_URL = "https://gm-z0j6.onrender.com/"; 
// --- НАСТРОЙКИ ---

const T = document.getElementById('T');
let isLoading = false; 

// Растягиваем текстовое поле на весь экран
T.style.width = '100%';
T.style.height = '100vh'; // 100% высоты окна просмотра
T.style.margin = '0';
T.style.padding = '10px';
T.style.border = 'none';
T.style.boxSizing = 'border-box';
T.style.fontFamily = 'monospace';
T.style.fontSize = '16px';


T.addEventListener('paste', async (e) => {
    if (isLoading) {
        e.preventDefault();
        return;
    }

    e.preventDefault();
    const pastedText = (e.clipboardData || window.clipboardData).getData('text');

    // 1. Введенный текст "пропадает" (заменяется на минимальный статус)
    isLoading = true;
    T.value = "......."; 
    T.style.color = "gray";
    T.disabled = true;
    
    // Формируем промпт (логика остается прежней)
    const prompt = `Role: ICPC Programmer.Task: Solve this problem in C++.
Requirements:1. Use #include <bits/stdc++.h>2. Use using namespace std;3. Optimize I/O: ios_base::sync_with_stdio(0); cin.tie(0);4. Short variable names (n, m, a, b).5. NO comments. ONLY CODE.6. Use signed main7. Don't use return 0 at the end of the code8. use #define endl '\\n'
Problem:${pastedText}`;

    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ inputs: prompt })
        });

        // Обработка сетевых ошибок
        if (response.status === 429) {
            throw new Error("429");
        }
        if (response.status === 502) {
             throw new Error("502");
        }
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();
        
        let resultText = "";
        
        if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
            resultText = data.candidates[0].content.parts[0].text;
        } else if (data.generated_text) {
            resultText = data.generated_text;
        } else if (data.error) {
            throw new Error(`API Error: ${JSON.stringify(data.error)}`);
        } else {
            throw new Error("Empty response");
        }

        // Очистка от ```cpp и ```
        resultText = resultText.replace(/^```[a-z]*\s*/i, '').replace(/```$/gm, '').trim();

        // 2. Появляется ответ
        T.value = resultText;
        T.style.color = "black";

    } catch (error) {
        console.error(error);
        T.value = `ERROR: ${error.message}`;
        T.style.color = "red";
        
    } finally {
        // Снимаем блокировку
        isLoading = false;
        T.disabled = false;
        T.focus(); 
    }
});
</script>
</body>
</html>
