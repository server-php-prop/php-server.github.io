<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>NSUts AI Solver - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 50px;
        }
        .container {
            width: 90%;
            max-width: 800px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #333;
        }
        textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box; /* –í–∞–∂–Ω–æ –¥–ª—è —à–∏—Ä–∏–Ω—ã */
        }
        #problemArea {
            height: 150px; /* –î–ª—è –≤–≤–æ–¥–∞ –∑–∞–¥–∞—á–∏ */
            background-color: #e8f0fe;
        }
        #codeArea {
            height: 400px; /* –î–ª—è –≤—ã–≤–æ–¥–∞ –∫–æ–¥–∞ */
            background-color: #fff;
        }
        .status-bar {
            text-align: right;
            margin-bottom: 10px;
        }
        #status-overlay {
            font-size: 14px;
            font-weight: bold;
            color: #555;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ü§ñ Gemini Code Solver (2.5 Flash)</h2>
        <div class="status-bar">
            <span id="status-overlay">–ì–æ—Ç–æ–≤ –∫ –ø—Ä–∏–µ–º—É –∑–∞–¥–∞—á–∏.</span>
        </div>
        
        <textarea id="problemArea" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –æ–ª–∏–º–ø–∏–∞–¥–Ω–æ–π –∑–∞–¥–∞—á–∏ —Å—é–¥–∞. –ù–∞—á–Ω–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞."></textarea>
        
        <textarea id="codeArea" placeholder="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π C++ –∫–æ–¥ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..." readonly></textarea>
        
    </div>

<script>
// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
const API_URL = "https://gm-z0j6.onrender.com/"; 
// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---

const problemArea = document.getElementById('problemArea');
const codeArea = document.getElementById('codeArea');
const statusSpan = document.getElementById('status-overlay');
let isLoading = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥–≤–æ–π–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

problemArea.addEventListener('paste', async (e) => {
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –ø–æ–∫–∞ –∏–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞
    if (isLoading) {
        e.preventDefault();
        return;
    }

    e.preventDefault();
    const pastedText = (e.clipboardData || window.clipboardData).getData('text');

    // 1. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    isLoading = true;
    codeArea.value = "‚è≥ –î—É–º–∞—é –Ω–∞–¥ –∑–∞–¥–∞—á–µ–π... (–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä Render)";
    codeArea.style.color = "gray";
    problemArea.disabled = true; // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
    statusSpan.textContent = "‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞...";
    
    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç
    const prompt = `Role: ICPC Programmer.Task: Solve this problem in C++.
Requirements:1. Use #include <bits/stdc++.h>2. Use using namespace std;3. Optimize I/O: ios_base::sync_with_stdio(0); cin.tie(0);4. Short variable names (n, m, a, b).5. NO comments. ONLY CODE.6. Use signed main7. Don't use return 0 at the end of the code8. use #define endl '\\n'
Problem:${pastedText}`;

    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ inputs: prompt })
        });

        // 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ (429, 502, 404)
        if (response.status === 429) {
            throw new Error("429: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1 –º–∏–Ω—É—Ç—É.");
        }
        if (response.status === 502) {
             throw new Error("502: Bad Gateway. –°–µ—Ä–≤–µ—Ä Render, –≤–æ–∑–º–æ–∂–Ω–æ, –∑–∞—Å—ã–ø–∞–µ—Ç/–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è.");
        }
        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
        }

        const data = await response.json();
        
        let aiCode = "";
        // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞
        if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
            aiCode = data.candidates[0].content.parts[0].text;
        } else if (data.generated_text) {
            aiCode = data.generated_text;
        } else if (data.error) {
            throw new Error(`Gemini API Error: ${JSON.stringify(data.error)}`);
        } else {
            throw new Error("–ü—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç–∏");
        }

        // –û—á–∏—Å—Ç–∫–∞ –æ—Ç ```cpp –∏ ```
        aiCode = aiCode.replace(/^```[a-z]*\s*/i, '').replace(/```$/gm, '').trim();

        codeArea.value = aiCode;
        codeArea.style.color = "black";
        statusSpan.textContent = "‚úÖ –ì–æ—Ç–æ–≤–æ! –ö–æ–¥ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω.";

    } catch (error) {
        console.error(error);
        codeArea.value = `// –û–®–ò–ë–ö–ê: ${error.message}`;
        codeArea.style.color = "red";
        statusSpan.textContent = "‚ùå –û—à–∏–±–∫–∞!";
        
    } finally {
        // –°–Ω–∏–º–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
        isLoading = false;
        problemArea.disabled = false;
        problemArea.focus(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å
    }
});
</script>
</body>
</html>
